#!/usr/bin/env bash
set -euxo pipefail

# Python
git clone https://github.com/pyenv/pyenv.git "$HOME/.pyenv"
git clone https://github.com/pyenv/pyenv-virtualenv.git "$HOME/.pyenv/plugins/pyenv-virtualenv"
# https://github.com/pyenv/pyenv/wiki#suggested-build-environment
sudo apt-get -y install make build-essential libssl-dev zlib1g-dev \
libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm \
libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev

# Poetry
command -v python3 || brew install python@3.10
curl -sSL https://install.python-poetry.org | python3 - --no-modify-path
mkdir -p "$XDG_CONFIG_HOME/fish"/completions
"$HOME/.poetry/bin"/poetry completions fish > "$XDG_CONFIG_HOME/fish/completions"/poetry.fish

# Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --no-modify-path

# SSH server
sudo apt-get -y install openssh-server
sudo ssh-keygen -A
sudo mkdir -p /etc/ssh/sshd_config.d
echo 'StreamLocalBindUnlink yes' | sudo tee -a /etc/ssh/sshd_config.d/clipper.conf
sudo tee -a /etc/ssh/sshd_config.d/wezterm.conf <<EOF
AcceptEnv WEZTERM*
AcceptEnv TERM*
AcceptEnv COLORTERM
EOF

# broot
/home/linuxbrew/.linuxbrew/bin/broot --install fish

# wezterm
sudo ln -s /home/linuxbrew/.linuxbrew/bin/wezterm /usr/local/bin/wezterm
